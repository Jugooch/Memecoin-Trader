# Memecoin Trading Bot Configuration Template
# Copy this file to config.yml and fill in your API keys

# Free RPC endpoint - no paid subscription needed
rpc_endpoint: "https://api.mainnet-beta.solana.com"

# BitQuery API Tokens - You can add multiple tokens for rotation
# Get from https://bitquery.io (sign up for free accounts)
bitquery_tokens:
  - your_first_bitquery_token_here
  - your_second_bitquery_token_here  # Optional: add more for rotation
  - your_third_bitquery_token_here   # Optional: add more for rotation

# Legacy single token support (will be converted to list)
bitquery_token: "your_bitquery_token_here"

# Pump Portal API configuration (recommended for real-time feeds)
pumpportal:
  api_key: "your_pumpportal_api_key_here"
  wallet_public_key: "your_wallet_public_key_here"    # Optional: for trading features
  wallet_private_key: "your_wallet_private_key_here"  # Optional: for trading features  
  ws_endpoint: "wss://pumpportal.fun/api/data"
  trade_endpoint: "https://pumpportal.fun/api/trade"

# Choose your real-time data source
realtime_source: "pumpportal"  # Options: "pumpportal" (recommended) or "bitquery"

# Moralis API Keys - You can add multiple keys for rotation
# Get from https://moralis.io (sign up for free accounts)
moralis_keys:
  - your_first_moralis_key_here
  - your_second_moralis_key_here  # Optional: add more for rotation
  - your_third_moralis_key_here   # Optional: add more for rotation

# Legacy single key support (will be converted to list)
moralis_key: your_moralis_key_here

# Optional QuickNode (only needed for automated live trading)
quicknode_endpoint: ""  # Leave empty to disable
quicknode_api_key: ""   # Leave empty to disable

# Alpha wallet addresses (discovered by alpha_discovery_v2.py)
watched_wallets:
  # Add proven alpha wallet addresses here
  # - wallet_address_1
  # - wallet_address_2

# Price Monitor Service Configuration
price_monitor:
  webhook_url: "YOUR_DISCORD_WEBHOOK_URL"  # Discord webhook for price updates
  update_interval_minutes: 30               # How often to send updates (in minutes)
  tracked_wallet: "4bmuhbVQPbVmXuqPHysyqGVq3UBou8NL9ukL4MwshGob"  # Wallet to track token creations
  top_movers_count: 10                      # Number of top gainers/losers to show

# Discord Bot Configuration (for /wallet-proof command)
discord_bot:
  bot_token: "YOUR_DISCORD_BOT_TOKEN"       # Bot token from Discord Developer Portal
  wallet_proofs_channel_id: null            # Optional: Channel ID to restrict command to specific channel

# Trading parameters (Phase 2: Bayesian Scoring) - STRICTER REQUIREMENTS
alpha_weight_min: 3.5         # Minimum weighted vote score (increased from 3.0)
require_one_wallet_pge_55: true  # Require at least one wallet with >55% win rate (ENABLED)
beta_prior_alpha: 3           # Bayesian prior alpha (wins + 1)
beta_prior_beta: 5            # Bayesian prior beta (losses + 1) = 37.5% baseline
threshold_alpha_buys: 5       # Minimum alpha wallets required (increased from 4)

# Discovery Quality Controls (Phase 3: Quality Improvements)
discovery_position_filters:
  min_position_usd: 10        # Minimum position size to avoid noise traders (LOWERED from 50)
  max_position_usd: 5000      # Maximum position size to focus on skill vs capital
  
discovery_quality_checks:
  max_co_occurrence_rate: 0.2 # Flag wallets with >20% coordination (STRICTER per GPT5)
  min_early_entry_rate: 0.4   # Minimum 40% early entries (within 2 minutes of launch)
  min_tokens_for_check: 3     # Only check wallets with 3+ tokens for wash trading
  enable_wash_trading_detection: true  # Enable wash trading pattern detection
  enable_risk_adjusted_scoring: true   # Enable risk-adjusted performance scoring
  min_exit_quality: 0.5       # Minimum exit timing quality (STRICTER: 0.5 = 50th percentile)
  min_consistency: 0.57       # Target 60-70% consistency for organic wallets (per GPT5)

# Entry Gate Configuration - Fast farming detection and wallet validation
entry_gate:
  max_decision_time_ms: 500           # Maximum time for entry decision (milliseconds)
  blacklist_after_traps: 3           # Auto-blacklist wallet after N trap events
  trust_after_successful: 10         # Auto-trust wallet after N successful trades
  trust_min_success_rate: 0.7        # Minimum success rate for auto-trust (70%)
  recent_trade_window: 90            # Window to check for recent exits (seconds)
  monitoring_window: 30              # Post-entry monitoring duration (seconds)
  emergency_exit_threshold: -0.15    # Trigger emergency exit if price drops 15%

# Farming Detection Parameters (NEW - based on GPT5 recommendations)
farming_detection:
  # 1. Holding Time Thresholds
  max_short_hold_rate: 0.70          # Flag if >70% of profitable trades closed < 5min
  median_hold_threshold: 180          # Flag if median hold < 3 minutes (180 seconds)
  short_hold_window: 300              # Define "short hold" as < 5 minutes (300 seconds)
  
  # 2. Entry Crowding Thresholds  
  entry_disadvantage_threshold: -0.03 # Flag if wallet consistently enters 3% better than followers
  entry_25pct_threshold: -0.05        # Flag if 25th percentile advantage < -5%
  
  # 3. Follower Disadvantage (FD) Thresholds
  max_follower_disadvantage: 0.05     # Flag if median FD > 5% (wallet gains, followers lose)
  max_75pct_follower_disadvantage: 0.08  # Flag if 75th percentile FD > 8%
  
  # 4. Exit Impact Thresholds
  max_exit_impact: 0.25               # Flag if wallet exit > 25% of pool volume
  high_exit_impact_rate: 0.50         # Flag if >= 50% of exits show > 15% impact
  
  # 5. Trade Synchrony Thresholds
  max_synchrony_rate: 0.60            # Flag if > 60% of trades have synchronized wallets
  synchrony_window: 5                 # Consider trades within 5 seconds as synchronized
  min_correlation: 0.70               # Minimum correlation for synchronized trading
  
  # 6. Funding Entropy Thresholds
  min_entropy: 1.0                    # Minimum Shannon entropy for funding diversity
  max_single_source_rate: 0.60        # Flag if > 60% of funds from single source
  
  # 7. Trade Size Uniformity
  max_size_uniformity: 0.50           # Flag if > 50% of trades within 2% of same size
  size_tolerance: 0.02                # 2% tolerance for uniform size detection
  max_coefficient_variation: 0.10     # Flag if coefficient of variation < 0.10
  
  # 8. Win Rate vs Hold Time
  suspicious_win_rate: 0.80           # 80% win rate with short holds = farming
  ultra_suspicious_win_rate: 0.90     # 90%+ win rate = definitely farming
  
  # 9. Liquidity Contribution
  min_lp_events: 1                    # Expect at least 1 LP event per 50 trades
  
  # 10. Token Survival
  min_survival_rate: 0.20             # Flag if < 20% of tokens survive 24h
  critical_survival_rate: 0.10        # Critical flag if < 10% survival
  
  # Overall Farmer Score Thresholds
  farmer_threshold: 0.60              # Score > 0.6 = BLACKLIST (definitely farming)
  suspicious_threshold: 0.40          # Score 0.4-0.6 = SUSPICIOUS (shadow only)
  # Score < 0.4 = SAFE (eligible to copy with guards)

# Enhanced alpha detection parameters - STRICTER ENTRY CONTROLS
alpha_enhanced:
  min_independent_wallets: 2          # Require 2+ independent wallets
  max_time_spread_seconds: 90         # NEW: Maximum time spread between alpha buys (90s)
  correlation_time_threshold_ms: 250  # Co-buy time threshold
  correlation_penalty_frequent: 0.8   # Penalty for frequent co-buyers (5+)
  correlation_penalty_some: 0.9       # Penalty for some co-buying (3+)
  correlation_penalty_shared_funder: 0.8  # Penalty for shared funding source

# Entry timing controls - NEW STRICTER SETTINGS
max_entry_delay_seconds: 180  # NEW: Maximum delay after first alpha buy (3 minutes)
price_extension_percentile: 90  # NEW: Block trades if price > 90th percentile

min_liquidity_usd: 25000      # Minimum liquidity required (higher quality tokens)
time_window_sec: 180          # Time window to wait for alpha activity (3 min for quick pumps)
max_trade_pct: 0.05           # Max % of capital per trade (5%)
tp_multiplier: 1.20           # Take profit multiplier (1.20x - achievable in 2-3 min)
stop_loss_pct: 0.95           # Stop loss percentage (5% loss - tighter for quick trades)
max_hold_seconds: 300         # Maximum time to hold position (5 minutes for quick pumps)

# Scratch rule parameters
scratch_rule:
  enabled: true                       # Enable scratch exits
  max_time_seconds: 45                # Only scratch in first 45s
  drawdown_threshold: 0.04            # 4% peak drawdown threshold
  exit_range_low: -0.03               # Scratch between -3% and -2%
  exit_range_high: -0.02
  buyer_acceleration_window: 30       # Window for buyer acceleration calc

# Token processing optimization (reduces Moralis API calls)
min_token_age_seconds: 10     # Wait time before checking Moralis (allows indexing)
alpha_first_strategy: true    # Check alpha activity before calling Moralis APIs

# Trading execution mode
trading_mode: "simulation"    # Options: "simulation", "alerts", "auto"
# simulation = Paper trading only
# alerts = Generate buy/sell alerts for manual execution  
# auto = Fully automated trading (requires QuickNode)

# Price monitoring configuration  
# Controls how frequently we poll Moralis for price updates on active positions
price_poll_interval: 2.0       # Seconds between price updates (2.0 = every 2 seconds)

# EXPERIMENTAL: Real-time position tracking (NEW FEATURE)
# When enabled, positions are updated immediately from WebSocket events
# instead of waiting for blockchain polling (5-15 second improvement)
use_realtime_positions: false  # Set to true to enable real-time position tracking

# Trading limits
trading:
  initial_capital: 500.0      # Starting capital ($) - optimized for $15-25 trades
  max_trades_per_day: 20      # Daily trade limit (reasonable for active trading)
  min_time_between_trades: 120 # Minimum seconds between trades (2 minutes to avoid overtrading)
  max_concurrent_positions: 3  # Maximum positions open at once
  
# Paper trading simulation parameters
paper_trading:
  fee_bps: 30                 # Trading fee in basis points (0.30%)
  buy_slippage_bps: 75        # Expected buy slippage (0.75%)
  sell_slippage_bps: 100      # Expected sell slippage (1.00%)
  max_slippage_bps: 150      # Maximum acceptable slippage (1.50%)

# API optimization settings
api_optimization:
  # Moralis cache TTLs (seconds)
  price_ttl: 8               # Price cache (use fresh=True for monitoring)  
  liquidity_ttl: 600         # Liquidity cache (10 minutes)
  swaps_ttl: 30              # Swaps cache (30s default, 10s for alpha)
  swaps_alpha_ttl: 10        # Faster updates during alpha checks
  
  # Alpha check optimization  
  alpha_polls_max: 3         # Maximum polls per alpha check
  alpha_poll_intervals: [3, 10, 20]  # Poll timing in seconds (faster for quick pumps)
  alpha_swap_limit: 50       # Swap limit per poll (reduced from 100)
  alpha_early_abort_min_buyers: 10   # Early abort threshold
  alpha_early_abort_buy_sell_ratio: 1.0  # Early abort ratio
  
  # Discovery V2 optimization (updated for more alpha wallets)
  discovery_max_moralis_tokens: 50    # Validate top 50 tokens (increased from 20)
  discovery_bitquery_success_threshold: 25  # Lower threshold (reduced from 40)
  discovery_early_window_minutes: 3   # Early buyer window (3 minutes matches entry window)
  
  # Discovery mode: "consistency" for steady performers, "champion" for 10x hunters  
  discovery_mode: "consistency"  # Focus on consistent organic traders
  
  # Control whether to discover new wallets at bot startup
  discover_new_wallets: true     # Set to false to skip discovery and use existing wallets only
  
  # Champion mode settings (finds wallets that caught 10x+ tokens)
  champion_settings:
    min_champion_hits: 1      # Require 1+ catches of 10x tokens (more realistic)
    min_super_high_hits: 2    # Or 2+ catches of 5x tokens (lowered from 3)
    lookback_days: 7          # Look back 7 days for champions
  
  # Multi-tier alpha wallet discovery (organic trader consistency focus)
  discovery_success_thresholds:
    excellent: 3.0  # 3x+ performance = excellent organic trade
    high: 2.0       # 2x+ performance = solid organic trade  
    medium: 1.5     # 1.5x+ performance = decent organic trade
    good: 1.3       # 1.3x+ performance = good organic trade
    modest: 1.15    # 1.15x+ performance = modest but profitable
  
  # ADJUSTED: Realistic requirements for consistent organic traders
  discovery_min_appearances:
    tier_1: 2     # Premium: 2+ high success tokens (realistic for consistency)
    tier_2: 3     # Good: 3+ medium success tokens (organic pattern)
    tier_3: 4     # Emerging: 4+ low success tokens (steady performers)

# Pump.fun configuration
pump_fun:
  program_address: "6EF8rrecthHAuSStzpf6aXr9HWs8jgPVr5S6fqF6P"
  api_endpoint: "https://pumpapi.fun"
  
# Enhanced safety checks
safety:
  require_sellability: true          # Check for recent sells (honeypot detection)
  max_price_impact: 0.008             # Maximum acceptable price impact (0.8% - tightened)
  sellability_window: 90              # Look for sells in last N seconds (increased from 60)
  min_distinct_sellers: 3             # Require 3+ distinct sellers (enhanced)
  max_sell_failure_rate: 0.05         # Max 5% sell failure rate (enhanced)
  hold_through_entry_check: true      # Enable copy-trade bait detection
  hold_through_window_seconds: 20     # Window to check for early exits
  price_extension_guard: true         # Enable price extension guard
  price_extension_percentile: 95      # Reject if price > p95 of last 60s
  
# Adaptive risk management (Phase 4.2)
risk_management:
  enabled: true               # Enable adaptive risk management
  position_size_pct: 0.05    # NEVER changes - always 5% to avoid fees
  # Risk levels based on daily P&L
  levels:
    normal:                  # 0% or positive P&L
      min_wallets: 3
      min_weight: 2.5
      max_daily_trades: 20
      min_time_between: 120
    cautious:                # -2% P&L
      min_wallets: 4
      min_weight: 3.0
      max_daily_trades: 15
      min_time_between: 180
    conservative:            # -4% P&L
      min_wallets: 5
      min_weight: 3.5
      max_daily_trades: 10
      min_time_between: 300
    defensive:               # -6% P&L or worse
      min_wallets: 6
      min_weight: 4.0
      max_daily_trades: 5
      min_time_between: 600

# Logging configuration
logging:
  level: "INFO"               # DEBUG, INFO, WARNING, ERROR
  file: "logs/trading.log"

# Database configuration
database:
  file: "trades.db"

# Discord notifications (optional but recommended)
# To get webhook URL: Server Settings -> Integrations -> Webhooks -> New Webhook
notifications:
  discord_webhook_url: ""  # Leave empty to disable Discord notifications
  enabled: true           # Toggle notifications on/off